<div class="central-nav">

    <%- include('header.ejs') %>

    <h1>
        archive
    </h1>

    <%
    // Group posts by year and month
    const postsByYear = {};
    for (let post of site.posts.data) {
        const date = new Date(post.date);
        const year = date.getFullYear();
        const month = date.toLocaleDateString('en-US', { month: 'long' });

        if (!postsByYear[year]) {
            postsByYear[year] = {};
        }
        if (!postsByYear[year][month]) {
            postsByYear[year][month] = [];
        }
        postsByYear[year][month].push(post);
    }
    %>

    <%
    // Sort years in descending order
    const sortedYears = Object.keys(postsByYear).sort((a, b) => b - a);

    for (let year of sortedYears) {
        const months = Object.keys(postsByYear[year]).sort((a, b) => {
            const monthA = new Date(a + ' 1, 2000').getMonth();
            const monthB = new Date(b + ' 1, 2000').getMonth();
            return monthB - monthA;
        });
    %>
        <div class="archive-year">
            <h2><%= year %> (<%= Object.values(postsByYear[year]).flat().length %> posts)</h2>

            <% for (let month of months) { %>
                <div class="archive-month">
                    <h3><%= month %> (<%= postsByYear[year][month].length %>)</h3>
                    <ul>
                        <% for (let post of postsByYear[year][month]) { %>
                            <li>
                                <span class="post-date"><%= post.date %></span>
                                <a href="<%- url_for(post.path) %>"><%- post.title %></a>
                            </li>
                        <% } %>
                    </ul>
                </div>
            <% } %>
        </div>
    <% } %>

    <style>
        .archive-year {
            margin-bottom: 2rem;
        }

        .archive-year h2 {
            margin-bottom: 1rem;
            color: #333;
        }

        .archive-month {
            margin-bottom: 1rem;
            margin-left: 1rem;
        }

        .archive-month h3 {
            margin-bottom: 0.5rem;
            color: #666;
            font-size: 1.1rem;
        }

        .archive-month ul {
            margin-left: 1rem;
            list-style-type: none;
            padding-left: 0;
        }

        .archive-month li {
            margin-bottom: 0.3rem;
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
        }

        .post-date {
            color: #999;
            font-size: 0.85rem;
            font-family: monospace;
        }

        .archive-month li a {
            color: #333;
            text-decoration: none;
        }

        .archive-month li a:hover {
            text-decoration: underline;
        }
    </style>

    <a href="/index.html" style="display: block; margin-top: 2rem;">[index]</a>

</div>